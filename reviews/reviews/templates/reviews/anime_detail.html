{% extends "reviews/base.html" %}
{% block content %}
<article class="detail">
  <div class="detail-header">
    {% if anime.capa_url %}
      <img src="{{ anime.capa_url }}" alt="Capa de {{ anime.titulo }}" class="capa-lg">
    {% endif %}
    <div>
      <h2>{{ anime.titulo }}</h2>
      <div class="stars">
        {% include "reviews/_stars.html" with value=media %}
        <span class="meta">{{ media|floatformat:1 }} / 5 • {{ qtd }} avaliações</span>
      </div>
      {% if minhas_estrelas %}
        <p class="meta">Sua avaliação: {{ minhas_estrelas }}★</p>
      {% endif %}
    </div>
  </div>

  {% if anime.sinopse %}
    <p class="sinopse">{{ anime.sinopse }}</p>
  {% endif %}

  <section class="avaliar">
    <h3>Avaliar este anime</h3>
    <form method="post" action="{% url 'rate_anime' anime.pk %}" class="rate-form">
      {% csrf_token %}
      <div class="nota-group">
        {{ form.nota }}
      </div>
      <div class="comentario-group">
        {{ form.comentario }}
      </div>
      <button class="btn" type="submit">Salvar avaliação</button>
    </form>
  </section>

  <section class="avaliacoes">
    <h3>Últimas avaliações</h3>
    <ul class="lista-avaliacoes">
      {% for r in avaliacoes %}
        <li>
          <span class="chips">{{ r.nota }}★</span>
          {% if r.comentario %}<span>{{ r.comentario }}</span>{% else %}<span class="meta">Sem comentário</span>{% endif %}
          <time class="meta">{{ r.created_at|date:"d/m/Y H:i" }}</time>
        </li>
      {% empty %}
        <li class="meta">Ainda não há avaliações.</li>
      {% endfor %}
    </ul>
  </section>
</article>
{% endblock %}
