{% extends 'base.html' %}

{% block content %}

<div style="display: flex; gap: 20px; margin-bottom: 30px;">
    <!-- Capa do Anime -->
    <div>
        {% if anime.images.jpg.image_url %}
            <img src="{{ anime.images.jpg.image_url }}" alt="Capa de {{ anime.title }}" style="width: 250px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.3);">
        {% endif %}
    </div>

    <!-- Informações do Anime -->
    <div style="flex: 1;">
        <h1 style="margin-top: 0;">{{ anime.title }}</h1>

        {% if erro %}
            <p style="color: red;">{{ erro }}</p>
        {% endif %}

        <p><strong>Sinopse:</strong> {{ anime.synopsis }}</p>
        <p><strong>Gêneros:</strong> {{ anime.genres|join:", " }}</p>
        <p><strong>Estúdios:</strong> {{ anime.studios|join:", " }}</p>

        {% if anime.status %}<p><strong>Status:</strong> {{ anime.status }}</p>{% endif %}
        {% if anime.episodes %}<p><strong>Episódios:</strong> {{ anime.episodes }}</p>{% endif %}
        {% if anime.score %}<p><strong>Nota Média:</strong> {{ anime.score }}</p>{% endif %}
        {% if anime.rank %}<p><strong>Rank:</strong> {{ anime.rank }}</p>{% endif %}

        {% if anime.trailer and anime.trailer.embed_url %}
            <p>
                <strong>Trailer:</strong><br>
                <iframe width="400" height="225" src="{{ anime.trailer.embed_url }}" frameborder="0" allowfullscreen style="border-radius: 10px; margin-top: 10px;"></iframe>
            </p>
        {% endif %}
    </div>
</div>

<hr style="margin: 30px 0;">

<!-- Avaliações -->
<h2>Avaliações</h2>

{% if reviews %}
    {% for review in reviews %}
        <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1);">
            <p><strong>{{ review.user.username }}</strong> - Nota: {{ review.score }}</p>
            {% if review.comment %}
                <p>{{ review.comment }}</p>
            {% endif %}
        </div>
    {% empty %}
        <p>Nenhuma avaliação ainda.</p>
    {% endfor %}
{% else %}
    <p>Nenhuma avaliação ainda.</p>
{% endif %}

<!-- Formulário de Avaliação -->
{% if user.is_authenticated %}
    {% with mal_id=anime.mal_id %}
        <form method="post" action="{% url 'avaliar_anime' mal_id %}" style="margin-top: 30px; max-width: 500px;">
            {% csrf_token %}
            <label for="score"><strong>Nota:</strong></label>
            <select name="score" id="score" required style="margin-left: 10px; padding: 5px;">
                <option value="10">10 - Obra-Prima</option>
                <option value="9">9 - Ótimo</option>
                <option value="8">8 - Muito Bom</option>
                <option value="7">7 - Bom</option>
                <option value="6">6 - Aceitável</option>
                <option value="5">5 - Mediano</option>
                <option value="4">4 - Ruim</option>
                <option value="3">3 - Péssimo</option>
                <option value="2">2 - Horrível</option>
                <option value="1">1 - Abominável</option>
            </select>

            <div style="margin-top: 10px;">
                <label for="comment"><strong>Comentário:</strong></label><br>
                <textarea name="comment" id="comment" rows="4" style="width: 100%; padding: 5px; border-radius: 5px;"></textarea>
            </div>

            <button type="submit" style="margin-top: 10px; padding: 8px 15px; border-radius: 5px; background-color: #4CAF50; color: white; border: none; cursor: pointer;">
                Enviar
            </button>
        </form>
    {% endwith %}
{% else %}
    <p style="margin-top: 20px;">Você precisa <a href="{% url 'login_user' %}">entrar</a> para avaliar este anime.</p>
{% endif %}

{% endblock %}
