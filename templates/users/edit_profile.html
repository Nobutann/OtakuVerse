{% extends 'base.html' %}
{% load static %}

{% block title %}Editar Perfil - OtakuVerse{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'users/css/profile.css' %}">

<main class="profile-main">
    <div class="container">
        <div class="edit-profile-header">
            <div class="header-content">
                <h1 class="page-title">Editar Perfil</h1>
                <p class="page-subtitle">Personalize suas informações e preferências</p>
            </div>
            <a href="{% url 'users:profile' user.username %}" class="btn btn-secondary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Voltar ao Perfil
            </a>
        </div>

        {% if error %}
            <div class="alert alert-error">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                </svg>
                {{ error }}
            </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="edit-profile-form">
            {% csrf_token %}
            
            <div class="form-sections">
                <!-- Seção Avatar e Informações Básicas -->
                <section class="form-section">
                    <h2 class="section-title">Avatar e Informações Básicas</h2>
                    
                    <div class="avatar-section">
                        <div class="current-avatar">
                            <img src="{{ profile.avatar.url }}" alt="Avatar atual" class="avatar-preview" id="avatarPreview">
                            <div class="avatar-overlay">
                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                    <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                                </svg>
                            </div>
                        </div>
                        
                        <div class="avatar-controls">
                            <label for="id_avatar" class="btn btn-primary avatar-btn">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/>
                                    <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                                </svg>
                                Escolher Avatar
                            </label>
                            <input type="file" id="id_avatar" name="avatar" accept="image/*" style="display: none;">
                            <p class="help-text">PNG, JPG ou GIF. Máximo 5MB.</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_birth_date" class="form-label">Data de Nascimento</label>
                            <input type="date" 
                                   id="id_birth_date" 
                                   name="birth_date" 
                                   value="{{ profile.birthDate|date:'Y-m-d'|default:'' }}"
                                   class="form-input">
                            <p class="help-text">Opcional.</p>
                        </div>

                        <div class="form-group">
                            <label for="id_gender" class="form-label">Gênero</label>
                            <select id="id_gender" name="gender" class="form-select">
                                <option value="">Não especificado</option>
                                {% for value, label in gender_choices %}
                                    <option value="{{ value }}" {% if profile.gender == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="customGenderGroup" {% if profile.gender != 'CUSTOM' %}style="display: none;"{% endif %}>
                        <label for="id_custom_gender" class="form-label">Gênero Personalizado</label>
                        <input type="text" 
                               id="id_custom_gender" 
                               name="custom_gender" 
                               value="{{ profile.custom_gender|default:'' }}"
                               placeholder="Especifique seu gênero"
                               class="form-input"
                               maxlength="50">
                    </div>
                </section>

                <!-- Seção Sobre Você -->
                <section class="form-section">
                    <h2 class="section-title">Sobre Você</h2>
                    
                    <div class="form-group">
                        <label for="id_bio" class="form-label">
                            Biografia
                            <span class="char-counter">
                                <span id="bioCounter">{{ profile.bio|length|default:0 }}</span>/500
                            </span>
                        </label>
                        <textarea id="id_bio" 
                                  name="bio" 
                                  rows="6" 
                                  class="form-textarea"
                                  placeholder="Conte um pouco sobre você, seus animes favoritos, hobbies..."
                                  maxlength="500">{{ profile.bio|default:'' }}</textarea>
                        <p class="help-text">Descreva seus gostos, animes favoritos ou qualquer coisa interessante sobre você.</p>
                    </div>
                </section>

                <!-- Seção Privacidade -->
                <section class="form-section">
                    <h2 class="section-title">Configurações de Privacidade</h2>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" 
                                       name="is_public" 
                                       {% if profile.isPublic %}checked{% endif %}
                                       class="checkbox-input">
                                <div class="checkbox-custom"></div>
                                <div class="checkbox-text">
                                    <strong>Perfil Público</strong>
                                    <p>Permite que outros usuários vejam seu perfil e informações</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" 
                                       name="show_stats" 
                                       {% if profile.showStats %}checked{% endif %}
                                       class="checkbox-input">
                                <div class="checkbox-custom"></div>
                                <div class="checkbox-text">
                                    <strong>Mostrar Estatísticas</strong>
                                    <p>Exibe suas estatísticas de animes (total assistido, episódios, etc.)</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </section>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                    </svg>
                    Salvar Alterações
                </button>
                <a href="{% url 'users:profile' user.username %}" class="btn btn-secondary btn-large">
                    Cancelar
                </a>
            </div>
        </form>
    </div>

    <script src="{% static 'users/js/profile.js' %}"></script>
</main>

{% endblock %}