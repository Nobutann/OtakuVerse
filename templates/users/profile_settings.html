{% extends "base.html" %}
{% load static %}

{% block title %}Configurações do perfil — OtakuVerse{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'users/account.css' %}">
<main class="page split">
  <section class="card">
    <h1 class="h1">Configurações</h1>
    <p class="sub">Atualize suas informações públicas e preferências.</p>

    <div class="tabs">
      <a class="tab is-active" href="#">Perfil</a>
      <a class="tab" href="{% url 'users:friends_list' %}">Amigos</a>
      <a class="tab" href="{% url 'users:friends_requests' %}">Pedidos</a>
    </div>

    <form class="form" onsubmit="return false">
      <div class="row" style="grid-template-columns:160px 1fr">
        <div class="grid">
          <img id="avatarPreview" src="{{ user.profile.avatar_url|default_if_none:static('users/default-avatar.png') }}" alt="" style="width:140px;height:140px;border-radius:999px;border:2px solid transparent;background:linear-gradient(#1c1e24,#1c1e24) padding-box,var(--grad) border-box">
          <label class="btn btn-ghost">
            <input id="avatarInput" type="file" accept="image/*" hidden>
            Trocar avatar
          </label>
        </div>
        <div class="grid">
          <label class="field">
            <span>Nome de exibição</span>
            <input type="text" value="{{ user.profile.display_name }}" placeholder="Seu nome público">
          </label>
          <label class="field">
            <span>Bio</span>
            <textarea rows="3" placeholder="Conte um pouco sobre você">{{ user.profile.bio }}</textarea>
          </label>
          <label class="field">
            <span>Website</span>
            <input type="url" value="{{ user.profile.website }}" placeholder="https://">
          </label>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid var(--border)">

      <label class="field">
        <span>Visibilidade</span>
        <select>
          <option {% if user.profile.is_public %}selected{% endif %}>Público</option>
          <option {% if not user.profile.is_public %}selected{% endif %}>Privado</option>
        </select>
      </label>

      <div class="actions">
        <button class="btn btn-primary" type="button">Salvar (UI)</button>
        <a class="btn" href="{% url 'users:profile_view' user.username %}">Ver meu perfil</a>
      </div>
    </form>
  </section>

  <aside class="card">
    <h3 style="margin-top:0">Conta</h3>
    <div class="grid">
      <a class="btn" href="{% url 'users:password_change' %}">Trocar senha</a>
      <form method="post" action="{% url 'users:logout' %}">{% csrf_token %}
        <button class="btn">Sair</button>
      </form>
      <div class="card" style="background:#221314;border-color:#5a2a2a">
        <h4 style="margin:0 0 6px">Excluir conta</h4>
        <p class="sub">Ação irreversível.</p>
        <button class="btn btn-danger" type="button">Excluir (UI)</button>
      </div>
    </div>
  </aside>
</main>

<script>
  const input = document.getElementById('avatarInput');
  const img = document.getElementById('avatarPreview');
  if (input) {
    input.addEventListener('change', e=>{
      const f = e.target.files?.[0]; if(!f) return;
      img.src = URL.createObjectURL(f);
    });
  }
</script>
{% endblock %}
